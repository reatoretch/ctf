# pwn reversin に関するメモ writeupなど？

## gdb の使い方!
```
gdb -q -ex 'set disassembly-flavor intel' -ex 'disp/i $pc' binary
```

便利コマンド
```
layout asm  # とりあえず同時にdisas結果を載せる
ni          # 関数内に入らないnext
p $rax      # raxを表示
```


## buffer over flow
そもそも文字列の入力長がチェックされない関数を使っている
returnアドレスや他の変数などが書き換えられる

## format string attack(format string bugs:fsb)
ksnctf の村人Aを倒したので書く
format string attackとは？
printfのフォーマットを使って危ないことをする
とりあえず入力があれば%p(数値の16進アドレス表示)を入力して何かしらのそれがフォーマットとして認識されたなら狙い目
### 基礎知識
#### %n
これまでに書き込んだ文字数をアドレスに書き込むやばいやつ

#### スタックの状態を確認
gdbでデバッグ実行時にx $espで見れるx/100 $espとかにするとたくさん見れる

#### %2$n,%3$x
引数2つ目に書き込む、3つ目の引数を表示するなどできる。便利

### 攻撃方法 
#### 入力文字列がローカル変数(スタック上にある)
入力文字列にアドレスを書きこんでそのアドレスを指して好きなアドレスに%nで書き込む

#### 入力文字列はグローバル変数(スタック上になさそう)かつ2回任意のformat stringを表示するprintfがある
スタック上にきっとスタック上をさすポインタがある(argv,envpなどがあるため)のでそのアドレスに書き込みたいアドレスを1回目の%nで書き込み次にその書き込みたいアドレスを指して%nで目的地に書き込む

### GOT overwrite
任意のアドレスに書き込めるようになったらGOTを書き換えるのが楽
関数の呼び出し場所を保存するテーブル(GOT)というものがある
readelfで確認できる
そのアドレスを指して書き換えると関数を呼び出したつもりが任意のアドレスをcallさせる動作ができる。
GOT overwriteができそうかの確認方法はそのうち調べる



